package com.lima.consoleservice.config.security;

import com.auth0.jwt.JWT;
import com.auth0.jwt.algorithms.Algorithm;

import com.auth0.jwt.interfaces.DecodedJWT;
import java.util.Date;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

@Component
public class JwtUtil {

  public static final long ON_MINUTE_TO_MILLIS = 60 * 1000L;
  private static String secretKey;
  private static long tokenTimeForMinute;

  @Value("${jwt.secret-key}")
  public void setSecretKey(String secretKey) {
    JwtUtil.secretKey = secretKey;
  }

  @Value("${jwt.token-time}")
  public static void setTokenTimeForMinute(long tokenTime) {
    JwtUtil.tokenTimeForMinute = tokenTime;
  }

  // jwt 토큰 생성
  public static String createToken(String name) {
    return JWT.create()
        .withSubject(name)
        .withIssuedAt(new Date())
        .withExpiresAt(new Date(System.currentTimeMillis() + tokenTimeForMinute * ON_MINUTE_TO_MILLIS))
        .sign(Algorithm.HMAC256(secretKey));
  }

  // jwt 토큰에서 클레임 추출
  private DecodedJWT extractClaim(String token) {
    return JWT.require(Algorithm.HMAC256(secretKey))
        .build()
        .verify(token);
  }

  // 추출한 클레임에서 name 추출
  public String extractName(String token) {
    return extractClaim(token).getSubject();
  }
}
